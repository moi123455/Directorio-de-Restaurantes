<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Directorio de Restaurantes</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css">
  <link rel="stylesheet" href="/directorio/style.css">
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<header>
  <div class="header-container">
    <div>
      <h1 class="header-title">Directorio de Restaurantes</h1>
      <p class="header-subtitle">Explora la gastronomía venezolana</p>
    </div>
    <nav class="header-nav">
      <ul>
        <!-- Botón de Login/Registro -->
        <li id="loginItem">
          <button id="btnOpenLogin" class="login-btn btn btn-primary">Login / Registro</button>
        </li>

        <!-- Info de usuario logeado -->
        <li id="userItem" style="display:none;">
          <span id="userName" style="font-weight:bold;"></span>
          <span id="adminBadge" style="display:none; background:yellow; color:black; padding:2px 6px; border-radius:4px; font-weight:bold; margin-left:5px;">ADMIN</span>
          <button id="btnLogout" class="logout-btn btn btn-danger btn-sm" style="margin-left:10px;">Cerrar sesión</button>
        </li>

        <!-- Enlaces existentes -->
        <li><a href="#restaurantes">Restaurantes</a></li>
        <li><a href="#contacto">Contacto</a></li>
        <li><a href="#acercade">Acerca de</a></li>
      </ul>
    </nav>
  </div>
</header>

<!-- Modal 1: Selección de rol -->
<div class="modal fade" id="modalRol" tabindex="-1" aria-labelledby="modalRolLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title w-100 text-center" id="modalRolLabel">¿Eres Usuario o Administrador?</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body text-center">
        <button class="btn btn-primary m-2" id="btnUsuario">Usuario</button>
        <button class="btn btn-warning m-2" id="btnAdmin">Administrador</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal 2: Selección de acción -->
<div class="modal fade" id="modalAccion" tabindex="-1" aria-labelledby="modalAccionLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title w-100 text-center" id="modalAccionLabel">¿Qué deseas hacer?</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body text-center">
        <button class="btn btn-success m-2" id="btnGoLogin">Iniciar Sesión</button>
        <button class="btn btn-info m-2" id="btnGoRegistro">Registrarme</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal 3: Formulario de login -->
<div class="modal fade" id="modalLogin" tabindex="-1" aria-labelledby="modalLoginLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title w-100 text-center" id="modalLoginLabel">Iniciar Sesión</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="formLogin">
          <div class="mb-3">
            <label for="loginEmail" class="form-label">Email o Usuario</label>
            <input type="text" class="form-control" id="loginEmail" required>
          </div>
          <div class="mb-3">
            <label for="loginPassword" class="form-label">Contraseña</label>
            <input type="password" class="form-control" id="loginPassword" required>
          </div>
          <button type="submit" class="btn btn-primary w-100">Entrar</button>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Modal 4: Formulario de registro -->
<div class="modal fade" id="modalRegistro" tabindex="-1" aria-labelledby="modalRegistroLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title w-100 text-center" id="modalRegistroLabel">Registro</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="formRegistro">
          <div class="mb-3">
            <label for="regNombre" class="form-label">Nombre completo</label>
            <input type="text" class="form-control" id="regNombre" required>
          </div>
          <div class="mb-3">
            <label for="regEmail" class="form-label">Correo electrónico</label>
            <input type="email" class="form-control" id="regEmail" required>
          </div>
          <div class="mb-3">
            <label for="regPassword" class="form-label">Contraseña</label>
            <input type="password" class="form-control" id="regPassword" required>
          </div>
          <button type="submit" class="btn btn-success w-100">Registrarme</button>
        </form>
      </div>
    </div>
  </div>
</div>


    <!-- Main Content -->
    <main class="main-container">
    <section>
        <h2 class="section-title">Bienvenido al Directorio</h2>
        <p class="section-description">
            Descubre una selección de restaurantes que celebran los auténticos sabores de Venezuela. 
            Cada establecimiento ofrece una experiencia única, con platos preparados con ingredientes frescos y tradición.
        </p>
    </section>

<!-- Search Section -->
        <section class="search-section">
            <div class="search-container">
                <input type="text" id="searchInput" class="search-input" placeholder="Buscar restaurante por nombre...">
                
                <div class="dropdown-container">
                    <button class="dropdown-btn" onclick="toggleDropdown()">
                        <i class="fas fa-list"></i>
                        Restaurantes
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="dropdown-menu" id="dropdownMenu">
                        <!-- Los elementos se llenarán dinámicamente -->
                    </div>
                </div>
                
                <button class="search-btn" onclick="searchRestaurants()">
                    <i class="fas fa-search"></i>
                    Buscar
                </button>
                
                <button class="clear-btn" onclick="clearSearch()">
                    <i class="fas fa-times"></i>
                    Limpiar
                </button>
            </div>
        </section>
        <!-- Restaurant Grid with Custom Scroll -->
        <section class="restaurant-grid-container">
            <div class="restaurant-grid" id="restaurantGrid">
                <!-- Restaurant cards will be inserted here dynamically -->
            </div>
            <div class="no-results" id="noResults">
                No se encontraron restaurantes que coincidan con tu búsqueda.
            </div>
        </section>

   
</main>

<section id="restaurantes" class="restaurantes">
        <div class="restaurants">
            <h2 class="section-title">Más Restaurantes</h2>
            <p class="section-description">
                Hay una gran variedad de restaurantes alojados en este directorio,
                pero pueden haber más. ¿Quieres que tu restaurante esté aquí? ¡Puedes
                hacerlo dando click al botón de abajo! 
                <img src="/directorio/descargar.jpeg" alt="">
                <button><a href="/añadirrestaurante/agregar_restaurante.html">¡Añade tu restaurante!</a></button>
            </p>
        </div>
    </section>

<section id="contacto" class="contacto">
    <div class="navcontacto">
        <h2 class="section-title">Contáctanos!</h2>
        <p class="section-description">
            Puedes tener una comunicación directa con nosotros los administradores del
            directorio. Si tienes alguna duda, sugerencia o quieres añadir tu restaurante, 
            puedes escribirnos a nuestro correo electrónico: 
            <a href="mailto:tecreamostupagina@gmail.com">tecreamostupagina@gmail.com</a>
            o llamarnos al número: <a href="tel:+584124567890">+58 412 456 7890</a>.
            <br>
            También puedes seguirnos en nuestras redes sociales:
            <br>
            <a href="https://www.instagram.com/webmasters.pro/" target="_blank"><i class="fa-brands fa-instagram"></i>Instagram</a>,
            <a href="https://www.facebook.com/profile.php?id=61576605815155" target="_blank"><i class="fa-brands fa-facebook"></i>Facebook</a>,
            <a href="https://x.com/CreamosTupagi" target="_blank"><i class="fa-brands fa-twitter"></i>Twitter</a>.
            <br>
            ¡Estamos aquí para ayudarte a disfrutar de la mejor gastronomía venezolana!
            <br>
            <p class="section-description">A continuación, te dejaremos una muestra del platillo que servimos:</p>
            <img src="/directorio/pabellon.jpg" alt="">
            <p class="centrado">Pabellón criollo</p>
        </p>
    </div>
</section>

<section id="acercade" class="acercade">
    <div class="navacercade">
        <h2 class="section-title">Sobre nosotros</h2>
        <p class="section-description">
            Somos un grupo de amantes de la gastronomía venezolana que hemos creado este
            directorio para ayudar a los comensales a encontrar los mejores restaurantes
            en el país. Nuestro objetivo es promover la cultura culinaria venezolana y
            apoyar a los restaurantes locales. Si tienes un restaurante y quieres
            formar parte de nuestro directorio, no dudes en contactarnos.
            <br>
            ¡Gracias por visitar nuestro sitio web y esperamos que disfrutes de tu experiencia
            gastronómica!
            <br>
        </p>
        <p class="social-devmedia">
            A continuación, te dejaremos los portfolios de los desarrolladores de este sitio web:
            <br>
            <a href="Portfolio/MoisésRojas/index.html" target="_blank">Moisés Rojas</a>,
            <a href="Portfolio/DanielSandoval/index.html" target="_blank">Daniel Sandoval</a>
        </p>
    </div>
</section>

     <!-- Footer -->
    <footer class="footer">
        <div class="footer-container">
            <div class="footer-grid">
                <div>
                    <h4 class="footer-title">Directorio de Restaurantes</h4>
                    <p>
                        Celebramos la gastronomía venezolana con una selección de los mejores restaurantes.
                    </p>
                </div>
                <div>
                    <h4 class="footer-title">Enlaces Rápidos</h4>
                    <ul class="footer-links">
                        <li><a href="#" class="footer-link">Inicio</a></li>
                        <li><a href="#restaurantes" class="footer-link">Restaurantes</a></li>
                        <li><a href="#contacto" class="footer-link">Contacto</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="footer-title">Contacto</h4>
                    <p class="footer-address">Calle Falsa 123, Ciudad, País</p>
                    <p class="footer-address">+123 456 7890</p>
                    <p class="footer-address">info@restaurantes.com</p>
                </div>
            </div>
            <p class="footer-copyright">
                © 2025 Directorio de Restaurantes. Todos los derechos reservados.
            </p>
        </div>
    </footer>
<script src="/directorio/app.js"></script>
<script>
let currentRole = null; // 'usuario' o 'admin'

// Abrir modal de rol desde el botón del header
document.getElementById('btnOpenLogin').addEventListener('click', () => {
  new bootstrap.Modal(document.getElementById('modalRol')).show();
});

// Elegir rol y pasar al modal de acción
document.getElementById('btnUsuario').addEventListener('click', () => {
  currentRole = 'usuario';
  bootstrap.Modal.getInstance(document.getElementById('modalRol')).hide();
  new bootstrap.Modal(document.getElementById('modalAccion')).show();
});

document.getElementById('btnAdmin').addEventListener('click', () => {
  currentRole = 'admin';
  bootstrap.Modal.getInstance(document.getElementById('modalRol')).hide();
  new bootstrap.Modal(document.getElementById('modalAccion')).show();
});

// Pasar a login o registro
document.getElementById('btnGoLogin').addEventListener('click', () => {
  bootstrap.Modal.getInstance(document.getElementById('modalAccion')).hide();
  new bootstrap.Modal(document.getElementById('modalLogin')).show();
});

document.getElementById('btnGoRegistro').addEventListener('click', () => {
  bootstrap.Modal.getInstance(document.getElementById('modalAccion')).hide();
  new bootstrap.Modal(document.getElementById('modalRegistro')).show();
});

// LOGIN
document.getElementById('formLogin').addEventListener('submit', async (e) => {
  e.preventDefault();
  const emailOrUser = document.getElementById('loginEmail').value;
  const password = document.getElementById('loginPassword').value;

  const url = currentRole === 'admin' ? '/api/admin/login' : '/api/usuarios/login';
  const body = currentRole === 'admin'
    ? { username: emailOrUser, password }
    : { email: emailOrUser, password };

  const res = await fetch(url, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(body)
  });

  const data = await res.json();
  if (res.ok) {
    bootstrap.Modal.getInstance(document.getElementById('modalLogin')).hide();
    if (currentRole === 'admin') {
      // Solo para tu demo
      window.open('/phpmyadmin', '_blank');
    }
    location.reload();
  } else {
    alert(data.error || 'Error en la autenticación');
  }
});

// REGISTRO
document.getElementById('formRegistro').addEventListener('submit', async (e) => {
  e.preventDefault();
  const nombre = document.getElementById('regNombre').value;
  const email = document.getElementById('regEmail').value;
  const password = document.getElementById('regPassword').value;

  const url = currentRole === 'admin' ? '/api/admin/register' : '/api/usuarios/register';
  const body = currentRole === 'admin'
    ? { username: prompt("Introduce un nombre de usuario:"), email, password, nombre_completo: nombre }
    : { nombre, email, password };

  const res = await fetch(url, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(body)
  });

  const data = await res.json();
  if (res.ok) {
    bootstrap.Modal.getInstance(document.getElementById('modalRegistro')).hide();
    location.reload();
  } else {
    alert(data.error || 'Error en el registro');
  }
});

// LOGOUT
document.getElementById('btnLogout').addEventListener('click', async () => {
  await fetch('/api/logout', { method: 'POST' });
  alert('Sesión cerrada');
  location.reload();
});
</script>


<script>
document.addEventListener('DOMContentLoaded', async () => {
    try {
        const res = await fetch('/api/session');
        const data = await res.json();

        const loginItem = document.getElementById('loginItem');
        const userItem = document.getElementById('userItem');
        const userName = document.getElementById('userName');
        const adminBadge = document.getElementById('adminBadge');
        const btnLogout = document.getElementById('btnLogout');

        if (data.role) {
            // Ocultar login y mostrar info de usuario
            loginItem.style.display = 'none';
            userItem.style.display = 'inline-block';

            // Mostrar nombre y badge si es admin
            if (data.role === 'admin') {
                userName.textContent = data.username || `Admin #${data.id}`;
                adminBadge.style.display = 'inline-block';
            } else {
                userName.textContent = data.nombre || `Usuario #${data.id}`;
                adminBadge.style.display = 'none';
            }

            // Evento cerrar sesión
            btnLogout.addEventListener('click', async () => {
                await fetch('/api/logout', { method: 'POST' });
                location.reload();
            });

        } else {
            // Mostrar login y ocultar info de usuario
            loginItem.style.display = 'inline-block';
            userItem.style.display = 'none';
        }
    } catch (err) {
        console.error('Error verificando sesión:', err);
    }
});
</script>

<!-- Bootstrap JS + Script de encadenado -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>



</body>
</html>